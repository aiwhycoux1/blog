<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">        

    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" integrity="sha384-awusxf8AUojygHf2+joICySzB780jVvQaVCAt1clU3QsyAitLGul28Qxb2r1e5g+" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">

      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCore.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shThemeEclipse.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/styles/shCoreEclipse.min.css">

    <link href="/css/custom.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Begin Jekyll SEO tag v2.0.0 -->
<title>How to Use Facebook’s Zstandard - Progur!</title>
<meta property="og:title" content="How to Use Facebook’s Zstandard" />
<meta name="description" content="In this article, you’re going to learn how to install and use Facebook’s ZStandard compression algorithm, popularly known as just ZStd. It is fast, and offers 19 different levels of compression." />
<meta property="og:description" content="In this article, you’re going to learn how to install and use Facebook’s ZStandard compression algorithm, popularly known as just ZStd. It is fast, and offers 19 different levels of compression." />
<link rel="canonical" href="http://progur.com/2016/09/how-to-install-and-use-zstd-facebook.html" />
<meta property="og:url" content="http://progur.com/2016/09/how-to-install-and-use-zstd-facebook.html" />
<meta property="og:site_name" content="Progur!" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-09-02T00:00:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@hathibel" />
<meta name="twitter:creator" content="@hathibel" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "How to Use Facebook’s Zstandard",
    "datePublished": "2016-09-02T00:00:00+05:30",
    "description": "In this article, you’re going to learn how to install and use Facebook’s ZStandard compression algorithm, popularly known as just ZStd. It is fast, and offers 19 different levels of compression.",
    "logo": "http://progur.com/assets/logo.jpg",
    "url": "http://progur.com/2016/09/how-to-install-and-use-zstd-facebook.html"
  }
</script>
<!-- End Jekyll SEO tag -->
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><i class="fa fa-terminal logo"></i> PROGUR!</a>
        </div>
        <!-- Options -->
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://twitter.com/hathibel" title="Follow me on Twitter"><i class="fa fa-lg fa-twitter" style="color: #4099FF"></i> &nbsp; Twitter</a></li>
            <li><a href="https://github.com/hathibelagal" title="Follow me on GitHub"><i class="fa fa-lg fa-github" style="color: #999999"></i> &nbsp; GitHub</a></li>
            <li><a href="https://medium.com/@hathibel" title="Follow me on Medium"><i class="fa fa-lg fa-medium" style="color: #0be370"></i> &nbsp; Medium</a></li>
            <li><a href="/feed.xml" title="Subscribe to our RSS feed"><i class="fa fa-lg fa-rss" style="color: #FF6600"></i>&nbsp; RSS</a></li>
          </ul>
        </div>
        <!-- End of Options -->
      </div>
    </nav>


<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div>
                <div>
                    <h1 class="post-title">How to Use Facebook's Zstandard</h1>
                    <div class="post-meta">Written by Ashraff Hathibelagal &bull; 02 September 2016</div>
                    <p style="margin-bottom: 20px"><span class="label label-info"><i class="fa fa-tag"> </i> &nbsp; Programming </span></p>
                    <div class="post-actual-content">
                        <h3 id="introduction">Introduction</h3>

<p>Recently, Facebook released version 1.0 of <a href="https://github.com/facebook/zstd">Zstandard</a>, popularly known as just Zstd. It is an implementation of a new data compression algorithm developed by <a href="https://github.com/Cyan4973">Yann Collet</a>, the same guy who developed LZ4 and xxHash. I believe that Zstandard might very well become the new de facto compression library of the future because it overcomes most of the limitations present in zlib, and offers markedly better compression ratios.</p>

<p>In this tutorial, I’ll be showing you how to install Zstd and use it both as a command line tool, and as a C library.</p>

<h3 id="installation">Installation</h3>

<p>The source code of Zstandard is available on <a href="https://github.com/facebook/zstd/releases/tag/v1.0.0">GitHub</a>. So, all you need to do is download it as a ZIP file. Once you have downloaded the file and extracted it, you must compile it. Doing so is easy if you are using Ubuntu. Just get inside the <strong>zstd-1.0.0</strong> directory, and run <code class="highlighter-rouge">make</code>.</p>

<pre class="brush: bash">
cd zstd-1.0.0
make install
</pre>

<p>Note that if you want to install <code class="highlighter-rouge">zstd</code> in a directory of your choice, you can use the <code class="highlighter-rouge">PREFIX</code> option. For example, if you want to install <code class="highlighter-rouge">zstd</code> inside <strong>/tmp/zstd</strong>, you would type in the following:</p>

<pre class="brush: bash">
cd zstd-1.0.0
make install PREFIX=/tmp/zstd
</pre>

<p>Of course, you would then have to add the zstd directory to your <code class="highlighter-rouge">PATH</code> variable manually.</p>

<p>If everything went well during the compilation, you’ll now have a binary file called <strong>zstd</strong>. To check if it is working, type in the following command:</p>

<pre class="brush: bash">
zstd --version
</pre>

<p>You should see output that looks similar to this:</p>

<pre class="brush: bash">
*** zstd command line interface 32-bits v1.0.0, by Yann Collet ***
</pre>

<h3 id="using-zstandard-as-a-compression-tool">Using Zstandard as a Compression Tool</h3>

<p>Using Zstandard is easy. You simply pass a file name to it, and it compresses it, generating a new file with a <code class="highlighter-rouge">.zst</code> extension.</p>

<p>For example, here’s how you would compress a file called <strong>myfile.txt</strong>:</p>

<pre class="brush: bash">
zstd myfile.txt
</pre>

<p>To decompress a file, you can use the <code class="highlighter-rouge">-d</code> option. Here’s how:</p>

<pre class="brush: bash">
zstd -d myfile.txt.zst
</pre>

<p>Alternatively, you could use the <code class="highlighter-rouge">unzstd</code> command.</p>

<pre class="brush: bash">
unzstd myfile.txt.zst
</pre>

<p>Usually, you would want to compress more than just one file. However, you can’t pass a directory to <code class="highlighter-rouge">zstd</code> directly. To overcome this limitation, you can simply use the <code class="highlighter-rouge">tar</code> command along with <code class="highlighter-rouge">zstd</code>.</p>

<pre class="brush: bash">
tar -cvf mydirectory.tar /mydirectory
zstd mydirectory.tar
</pre>

<p>Zstandard offeres 19 different levels of compression. The default level is 3. Here’s how you use a higher compression level:</p>

<pre class="brush: bash">
zstd -15 myfile.txt
</pre>

<p>Of course, a higher compression level also means the time taken to compress is longer.</p>

<h3 id="using-zstandard-as-a-library">Using Zstandard as a Library</h3>

<p>Let me now show you how to use Zstandard in a C program. I’ll be using Ubuntu as my operating system. Therefore, we’ll be working with <code class="highlighter-rouge">gcc</code>.</p>

<p>To be able to use Zstandard in your program, you must include the <code class="highlighter-rouge">zstd.h</code> header file. To follow this tutorial, you will also need <code class="highlighter-rouge">stdio.h</code>, <code class="highlighter-rouge">stdlib.h</code>, <code class="highlighter-rouge">string.h</code>.</p>

<pre class="brush: cpp">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

#include &lt;zstd.h&gt;

int main() {

}
</pre>

<p>In this tutorial, I’ll be showing you how to compress a string. You can, however, use this knowledge to compress other forms of data too.</p>

<pre class="brush: cpp">
char* my_data = "aaaaaaabbbbbbbbbccccccccddddddddeeeeeeeefffffffffggggggggg";
size_t size_of_data = strlen(my_data);
</pre>

<p>We must now create a buffer for the compressed data, and also decide how big it should be. <code class="highlighter-rouge">zstd.h</code> has a helper function called <code class="highlighter-rouge">ZSTD_compressBound()</code> that lets you know what the buffer size would have to be in the worst case.</p>

<pre class="brush: cpp">
size_t estimated_size_of_compressed_data = ZSTD_compressBound(size_of_data);
void* compressed_data = malloc(estimated_size_of_compressed_data);
</pre>

<p>To compress your data, you must call the <code class="highlighter-rouge">ZSTD_compress()</code> function. It returns the actual size of the compressed data.</p>

<pre class="brush: cpp">
size_t actual_size_of_compressed_data = 
        ZSTD_compress(compressed_data, estimated_size_of_compressed_data, 
            my_data, size_of_data, 19);
</pre>

<p>Note that the last argument to the function is the compression level, which can range from 1(lowest) to 22(highest).</p>

<p>At this point, the <code class="highlighter-rouge">compressed_data</code> buffer stores the data in a compressed format. You can easily write it to a file using <code class="highlighter-rouge">fwrite()</code>. The output file must, of course, be opened in binary mode.</p>

<pre class="brush: cpp">
FILE *fp = fopen("/tmp/mydata.zst", "wb");
fwrite(compressed_data, actual_size_of_compressed_data, 1, fp);
fclose(fp);
</pre>

<p>The program is ready. To compile it, you can use <code class="highlighter-rouge">gcc</code> as follows:</p>

<pre class="brush: bash">
gcc myprogram.c -lzstd
</pre>

<p>You can check if the compressed data can be decompressed by passing <strong>mydata.zst</strong>, which is the output of our program, to <code class="highlighter-rouge">zstdcat</code>.</p>

<pre class="brush: bash">
zstdcat /tmp/mydata.zst
</pre>

<h3 id="conclusion">Conclusion</h3>

<p>You now know how to use Zstandard. Although we focused on using it using the C language only, Zstandard has bindings for several languages.</p>

                    </div>

                    <!-- Share -->
                    <div class="post-share">
                        <p>If you found this article useful, please share it with your friends and colleagues!</p>
                        <a class="btn btn-primary" style="background:#4099FF" target="_blank" href="https://twitter.com/intent/tweet?text=How to Use Facebook&#39;s Zstandard&url=http://progur.com/2016/09/how-to-install-and-use-zstd-facebook.html&via=hathibel" onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=600');return false;"><i class="fa fa-twitter fa-lg"></i></a>

                        <a class="btn btn-primary" style="background:#3b5998" target="_blank" href="https://facebook.com/sharer.php?u=http://progur.com/2016/09/how-to-install-and-use-zstd-facebook.html" onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=600');return false;"><i class="fa fa-facebook fa-lg"></i></a>
                        
                        <a class="btn btn-primary" style="background:#dd4b39" target="_blank" href="https://plus.google.com/share?url=http://progur.com/2016/09/how-to-install-and-use-zstd-facebook.html" onclick="javascript:window.open(this.href,
  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><i class="fa fa-google-plus fa-lg"></i></a>
                    </div>

                    <!-- End of Share -->

                    <!-- Comments -->
                      <div class="comments">
                          <div id="disqus_thread"></div>
                            <script>                                    
                                var disqus_config = function () {
                                    this.page.url = "http://progur.com/2016/09/how-to-install-and-use-zstd-facebook.html";
                                    this.page.identifier = "/2016/09/how-to-install-and-use-zstd-facebook.html";
                                };
                                (function() {
                                    var d = document, s = d.createElement('script');

                                    s.src = '//progur.disqus.com/embed.js';

                                    s.setAttribute('data-timestamp', +new Date());
                                    (d.head || d.body).appendChild(s);
                                })();
                            </script>
                            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                      </div>
                    <!-- End of comments -->
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
  <div class="container">
    <p>
        Copyright &copy; 2016-2017 Progur.com | All rights reserved.
        <br/>
        Powered by Jekyll, and several secret sauces.
    </p>
  </div>
</footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shAutoloader.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shCore.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushBash.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushJava.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushPython.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushXml.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushRuby.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushCpp.min.js"></script>
          <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushJScript.min.js"></script>

          <script>
              SyntaxHighlighter.defaults.toolbar = false;
              SyntaxHighlighter.all();
          </script>

        <!-- Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-46644689-5', 'auto');
          ga('send', 'pageview');

        </script>
        <!-- End of Analytics -->

  </body>
</html>

